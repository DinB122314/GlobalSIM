<!DOCTYPE html>
<html>
<head>
  <title>Order History - GlobalSim</title>
</head>
<body>
  <h2>Your Order History</h2>
  <ul id="orderList">Loading...</ul>

  <p><a href="dashboard.html">⬅ Back to Dashboard</a></p>

  <script type="module">
    import { auth, onAuthStateChanged } from './firebase.js';
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const db = getFirestore();
    const orderList = document.getElementById("orderList");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const q = query(
        collection(db, "orders"),
        where("userId", "==", user.uid)
      );

      const querySnapshot = await getDocs(q);
      orderList.innerHTML = "";

      if (querySnapshot.empty) {
        orderList.innerHTML = "<li>No orders found.</li>";
      } else {
        querySnapshot.forEach((doc) => {
          const order = doc.data();
          const item = document.createElement("li");
          item.innerText = `✅ ${order.type} - $${order.amount} - ${new Date(order.date.seconds * 1000).toLocaleString()}`;
          orderList.appendChild(item);
        });
      }
    });
  </script>
</body>
</html>
